@model Firmeza.Web.Data.Entities.Sale
@{
    ViewData["Title"] = "Pedido Confirmado";
    Layout = "~/Views/Shared/_ShopLayout.cshtml";
}

<div class="container py-5">
    <!-- Mensaje de éxito -->
    <div class="text-center mb-5">
        <div class="mb-4">
            <i class="bi bi-check-circle-fill text-success" style="font-size: 5rem;"></i>
        </div>
        <h1 class="display-4 text-success mb-3">¡Pedido Confirmado!</h1>
        <p class="lead">Tu pedido ha sido recibido correctamente</p>
        <p class="text-muted">
            Número de orden: <strong class="text-primary">@Model.InvoiceNumber</strong>
        </p>
    </div>

    <!-- Información del pedido -->
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <!-- Detalles del cliente y entrega -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-info-circle"></i> Información del Pedido</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <h6 class="text-muted">Datos del Cliente</h6>
                            <p class="mb-1"><strong>@Model.Customer.FullName</strong></p>
                            <p class="mb-1">
                                <i class="bi bi-card-text"></i> @Model.Customer.DocumentNumber
                            </p>
                            @if (!string.IsNullOrEmpty(Model.Customer.PhoneNumber))
                            {
                                <p class="mb-1">
                                    <i class="bi bi-telephone"></i> @Model.Customer.PhoneNumber
                                </p>
                            }
                            @if (!string.IsNullOrEmpty(Model.Customer.Email))
                            {
                                <p class="mb-1">
                                    <i class="bi bi-envelope"></i> @Model.Customer.Email
                                </p>
                            }
                        </div>

                        <div class="col-md-6 mb-3">
                            <h6 class="text-muted">Dirección de Entrega</h6>
                            <p>
                                <i class="bi bi-geo-alt"></i> @Model.DeliveryAddress
                            </p>
                            <p class="mb-1">
                                <i class="bi bi-calendar"></i> 
                                <strong>Fecha estimada:</strong> 
                                @Model.Date.AddDays(3).ToString("dd/MM/yyyy")
                            </p>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-muted">Método de Pago</h6>
                            <p>
                                @switch (Model.PaymentFrom)
                                {
                                    case Firmeza.Web.Data.Entities.PaymentFrom.Cash:
                                        <i class="bi bi-cash"></i> <span>Efectivo</span>
                                        break;
                                    case Firmeza.Web.Data.Entities.PaymentFrom.Transfer:
                                        <i class="bi bi-bank"></i> <span>Transferencia</span>
                                        break;
                                    case Firmeza.Web.Data.Entities.PaymentFrom.CreditCard:
                                        <i class="bi bi-credit-card-2-front"></i> <span>Tarjeta de Crédito</span>
                                        break;
                                    case Firmeza.Web.Data.Entities.PaymentFrom.DebitCard:
                                        <i class="bi bi-credit-card"></i> <span>Tarjeta de Débito</span>
                                        break;
                                    case Firmeza.Web.Data.Entities.PaymentFrom.Credit:
                                        <i class="bi bi-calendar-check"></i> <span>Crédito (30 días)</span>
                                        break;
                                }
                            </p>
                        </div>

                        <div class="col-md-6">
                            <h6 class="text-muted">Estado del Pedido</h6>
                            <span class="badge bg-warning p-2">
                                <i class="bi bi-clock"></i> Pendiente de Procesamiento
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Productos pedidos -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0"><i class="bi bi-box-seam"></i> Productos Pedidos</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>Producto</th>
                                    <th class="text-center">Cantidad</th>
                                    <th class="text-end">Precio Unit.</th>
                                    <th class="text-end">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var detail in Model.SalesDetails)
                                {
                                    <tr>
                                        <td>
                                            <strong>@detail.Product.Name</strong><br/>
                                            
                                        </td>
                                        <td class="text-center">@detail.Quantity</td>
                                        <td class="text-end">$@detail.Price.ToString("N0")</td>
                                        <td class="text-end"><strong>$@detail.Total.ToString("N0")</strong></td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Totales -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="bi bi-calculator"></i> Resumen de Pago</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 offset-md-6">
                            <div class="d-flex justify-content-between mb-2">
                                <span>Subtotal:</span>
                                <strong>$@Model.SubTotal.ToString("N0")</strong>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span>IVA (19%):</span>
                                <strong>$@Model.Vat.ToString("N0")</strong>
                            </div>
                            <div class="d-flex justify-content-between text-success mb-2">
                                <span>Envío:</span>
                                <strong>GRATIS</strong>
                            </div>
                            <hr>
                            <div class="d-flex justify-content-between">
                                <h5>Total:</h5>
                                <h4 class="text-primary">$@Model.Total.ToString("N0")</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Próximos pasos -->
            <div class="card shadow-sm mb-4 border-primary">
                <div class="card-header bg-light">
                    <h5 class="mb-0 text-primary">
                        <i class="bi bi-lightbulb"></i> ¿Qué sigue?
                    </h5>
                </div>
                <div class="card-body">
                    <ol class="mb-0">
                        <li class="mb-2">
                            <strong>Procesamiento:</strong> Verificaremos tu pedido y prepararemos los productos
                        </li>
                        <li class="mb-2">
                            <strong>Confirmación:</strong> Te contactaremos para confirmar la entrega
                        </li>
                        <li class="mb-2">
                            <strong>Envío:</strong> Entregaremos tu pedido en la dirección indicada
                        </li>
                        <li>
                            <strong>Pago:</strong> 
                            @if (Model.PaymentFrom == Firmeza.Web.Data.Entities.PaymentFrom.Cash)
                            {
                                <span>Podrás pagar en efectivo al recibir el pedido</span>
                            }
                            else if (Model.PaymentFrom == Firmeza.Web.Data.Entities.PaymentFrom.Credit)
                            {
                                <span>Tienes 30 días para realizar el pago</span>
                            }
                            else
                            {
                                <span>Te enviaremos los datos de pago por correo</span>
                            }
                        </li>
                    </ol>
                </div>
            </div>

            <!-- Botones de acción -->
            <div class="text-center">
                <a asp-action="Index" class="btn btn-primary btn-lg me-2">
                    <i class="bi bi-shop"></i> Seguir Comprando
                </a>
                <a asp-controller="Sales" asp-action="PrintPdf" 
                   class="btn btn-outline-primary btn-lg" target="_blank">
                    <i class="bi bi-printer"></i> Imprimir Pedido
                </a>
            </div>

            <!-- Información de contacto -->
            <div class="alert alert-info mt-4 text-center">
                <i class="bi bi-info-circle"></i> 
                <strong>¿Tienes dudas?</strong><br/>
                Contáctanos: <a href="tel:+576053001234">(605) 300-1234</a> | 
                <a href="mailto:ventas@firmeza.com">ventas@firmeza.com</a>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Limpiar carrito del header
        document.getElementById('cart-count').textContent = '0';

        // Mostrar mensaje de bienvenida
        setTimeout(() => {
            if (confirm('¡Gracias por tu compra! ¿Deseas recibir notificaciones de WhatsApp sobre tu pedido?')) {
                // Aquí podrías integrar con WhatsApp API
                window.open('https://wa.me/573001234567?text=Hola, quiero recibir actualizaciones del pedido @Model.InvoiceNumber', '_blank');
            }
        }, 2000);
    </script>
}